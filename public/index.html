<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Preconnect and load Google fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" 
        href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700">
  <title>xAIM 3D</title>
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    /* Add these styles after your existing styles */
    .button-success {
      background: linear-gradient(90deg, #00ff88, #00cc6f) !important;
      transform: scale(1.05);
      transition: all 0.3s ease;
      min-width: max-content; /* Prevent width changes */
      color: #8000ff !important; /* Keep purple text color */
      text-shadow: 0 0 10px rgba(128, 0, 255, 0.5); /* Add glow effect to text */
    }

    .button-error {
      background: linear-gradient(90deg, #ff3333, #cc0000) !important;
      transform: scale(1.05);
      transition: all 0.3s ease;
      min-width: max-content; /* Prevent width changes */
    }

    #copyTokenBtn {
      min-width: 180px; /* Set a fixed minimum width */
      white-space: nowrap; /* Prevent text wrapping */
    }

    /* Add a simple red style for the error message */
    .error-message {
      color: red;
      margin-top: 0.5rem;
      margin-bottom: 1rem;  /* adjust spacing as you prefer */
      font-weight: 600;
    }

    /* Workflow Container */
    .workflow-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .workflow-step {
      display: flex;
      gap: 20px;
      padding: 25px;
      background: rgba(91, 19, 236, 0.1);
      border-radius: 15px;
      border: 1px solid rgba(91, 19, 236, 0.2);
      box-shadow: 
        0 0 20px rgba(91, 19, 236, 0.1),
        inset 0 0 10px rgba(91, 19, 236, 0.05);
      transition: all 0.3s ease;
    }

    .workflow-step:hover {
      transform: translateY(-2px);
      background: rgba(91, 19, 236, 0.15);
      border-color: rgba(91, 19, 236, 0.3);
      box-shadow: 
        0 0 30px rgba(91, 19, 236, 0.2),
        inset 0 0 15px rgba(91, 19, 236, 0.1);
    }

    .step-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #8000ff, #5b13ec);
      border-radius: 50%;
      font-size: 24px;
      font-weight: 700;
      color: white;
      box-shadow: 0 0 15px rgba(91, 19, 236, 0.3);
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .step-content {
      flex: 1;
    }

    .step-content h3 {
      color: #8000ff;
      margin: 0 0 10px 0;
      font-size: 1.4em;
      font-weight: 700;
      text-shadow: 0 0 10px rgba(128, 0, 255, 0.3);
    }

    .step-content p {
      color: #fff;
      margin: 0 0 15px 0;
      font-size: 1em;
      opacity: 0.9;
    }

    .step-content ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .step-content li {
      margin: 8px 0;
      padding-left: 20px;
      position: relative;
      color: rgba(255, 255, 255, 0.8);
    }

    .step-content li::before {
      content: '→';
      position: absolute;
      left: 0;
      color: #8000ff;
      font-weight: bold;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .workflow-step {
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 20px;
      }

      .step-content li {
        padding-left: 0;
      }

      .step-content li::before {
        display: none;
      }
    }

    /* How It Works Styles */
    .how-it-works-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 0;
    }

    .reveal-process-btn {
      position: relative;
      padding: 15px 30px;
      font-size: 1.2em;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(45deg, #00bfff, #0077be);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 
        0 0 20px rgba(0, 191, 255, 0.3),
        inset 0 0 15px rgba(255, 255, 255, 0.2);
    }

    .reveal-process-btn:hover {
      transform: translateY(-2px) scale(1.05);
      background: linear-gradient(45deg, #00d4ff, #0088cc);
      box-shadow: 
        0 0 30px rgba(0, 191, 255, 0.5),
        inset 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .reveal-process-btn .btn-text {
      position: relative;
      z-index: 1;
      text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
    }

    .btn-particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .btn-particles::before,
    .btn-particles::after {
      content: '';
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.7);
      transition: all 0.3s ease;
    }

    .reveal-process-btn:hover .btn-particles::before,
    .reveal-process-btn:hover .btn-particles::after {
      animation: particleFloat 1s infinite alternate;
    }

    @keyframes particleFloat {
      0% {
        transform: translate(0, 0);
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translate(10px, -10px);
        opacity: 0;
      }
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(8px);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal.active {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      position: relative;
      width: 95%;
      max-width: 1000px;
      margin: auto;
      background: rgba(46, 40, 57, 0.95);
      border-radius: 20px;
      padding: 30px;
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.5s ease;
      border: 2px solid rgba(0, 191, 255, 0.3);
      box-shadow: 
        0 0 40px rgba(0, 191, 255, 0.2),
        inset 0 0 20px rgba(0, 191, 255, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .modal.active .modal-content {
      transform: translateY(0);
      opacity: 1;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid rgba(0, 191, 255, 0.3);
      background: rgba(46, 40, 57, 0.95);
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: rgba(0, 191, 255, 0.2);
      transform: rotate(90deg);
    }

    .modal-title {
      text-align: center;
      font-size: 1.8em;
      color: #fff;
      margin: 0 0 10px 0; /* Reduced margin-bottom from 20px to 10px */
      text-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
      padding-top: 10px; /* Add some padding at the top */
    }

    /* Steps Grid */
    .steps-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      padding: 0;
      margin-top: 0; /* Ensure no extra space at the top */
    }

    .step {
      position: relative;
      background: rgba(0, 191, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 191, 255, 0.2);
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .modal.active .step {
      opacity: 1;
      transform: translateY(0);
    }

    .step:nth-child(1) { transition-delay: 0.1s; }
    .step:nth-child(2) { transition-delay: 0.2s; }
    .step:nth-child(3) { transition-delay: 0.3s; }
    .step:nth-child(4) { transition-delay: 0.4s; }

    .step-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .step-icon {
      width: 40px;
      height: 40px;
      min-width: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #00bfff, #0077be);
      border-radius: 10px;
      color: #fff;
      transition: all 0.3s ease;
    }

    .step-icon svg {
      width: 24px;
      height: 24px;
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
    }

    .step-content {
      flex: 1;
    }

    .step h3 {
      color: #fff;
      margin: 0;
      font-size: 1.2em;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
    }

    .step-content ul {
      list-style: none;
      padding: 0;
      margin: 8px 0 0 0;
    }

    .step-content li {
      margin: 6px 0;
      padding-left: 20px;
      position: relative;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.95em;
      transition: all 0.3s ease;
    }

    .step-content li::before {
      content: '→';
      position: absolute;
      left: 0;
      color: #00bfff;
      font-weight: bold;
      opacity: 0;
      transform: translateX(-10px);
      transition: all 0.3s ease;
    }

    .step:hover {
      background: rgba(0, 191, 255, 0.15);
      transform: translateY(-2px);
      box-shadow: 
        0 0 20px rgba(0, 191, 255, 0.2),
        inset 0 0 10px rgba(0, 191, 255, 0.1);
    }

    .step:hover .step-icon {
      transform: scale(1.1) rotate(5deg);
      background: linear-gradient(135deg, #00d4ff, #0088cc);
    }

    .step:hover li::before {
      opacity: 1;
      transform: translateX(0);
    }

    .step:hover li {
      color: rgba(255, 255, 255, 1);
      padding-left: 25px;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .modal-content {
        padding: 20px;
        width: 90%;
      }

      .steps-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .step {
        padding: 15px;
      }

      .step-header {
        gap: 10px;
      }

      .step-icon {
        width: 35px;
        height: 35px;
        min-width: 35px;
      }

      .step-icon svg {
        width: 20px;
        height: 20px;
      }

      .step h3 {
        font-size: 1.1em;
      }

      .step-content li {
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="design-root">
    <div class="layout-container">
      <!-- HEADER -->
      <header class="header">
        <div class="logo-container">
          <div class="logo-icon">
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M39.475 21.6262C40.358 21.4363 40.6863 21.5589 40.7581 21.5934C40.7876 21.655 40.8547 21.857 40.8082 22.3336C40.7408 23.0255 40.4502 24.0046 39.8572 25.2301C38.6799 27.6631 36.5085 30.6631 33.5858 33.5858C30.6631 36.5085 27.6632 38.6799 25.2301 39.8572C24.0046 40.4502 23.0255 40.7407 22.3336 40.8082C21.8571 40.8547 21.6551 40.7875 21.5934 40.7581C21.5589 40.6863 21.4363 40.358 21.6262 39.475C21.8562 38.4054 22.4689 36.9657 23.5038 35.2817C24.7575 33.2417 26.5497 30.9744 28.7621 28.762C30.9744 26.5497 33.2417 24.7574 35.2817 23.5037C36.9657 22.4689 38.4054 21.8562 39.475 21.6262ZM4.41189 29.2403L18.7597 43.5881C19.8813 44.7097 21.4027 44.9179 22.7217 44.7893C24.0585 44.659 25.5148 44.1631 26.9723 43.4579C29.9052 42.0387 33.2618 39.5667 36.4142 36.4142C39.5667 33.2618 42.0387 29.9052 43.4579 26.9723C44.1631 25.5148 44.659 24.0585 44.7893 22.7217C44.9179 21.4027 44.7097 19.8813 43.5881 18.7597L29.2403 4.41187C27.8527 3.02428 25.8765 3.02573 24.2861 3.36776C22.6081 3.72863 20.7334 4.58419 18.8396 5.74801C16.4978 7.18716 13.9881 9.18353 11.5858 11.5858C9.18354 13.988 7.18717 16.4978 5.74802 18.8396C4.58421 20.7334 3.72865 22.6081 3.36778 24.2861C3.02574 25.8765 3.02429 27.8527 4.41189 29.2403Z"
                fill="currentColor"
              ></path>
            </svg>
          </div>
          <h2 class="logo-text">xAIM 3D</h2>
        </div>
        <div class="nav-container">
          <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="gallery.html" class="nav-link">Gallery</a>
            <a href="tournament.html" class="nav-link">Tournament</a>
            <a href="docs.html" class="nav-link">About Coin</a>
          </div>
        </div>
      </header>
      
      <!-- MAIN CONTENT -->
      <div class="content-container">
        <div class="layout-content-container">
          <div class="banner-container">
            <div class="banner">
              <div class="banner-content">
                <h1 class="banner-title">xAIM</h1>
                <p class="banner-subtitle">ARTIFICIAL INTELLIGENCE MESH</p>
              </div>
            </div>
            <div class="banner-bottom">
              <p class="banner-subtitle">THE MASCOT GAMES:<br>OpenAI, DeepSeek, and Grok 3 Combined</p>
            </div>
          </div>
          <p class="section-description scroll-reveal">
            Create your own customized 3D mascot and bring your unique digital figure to life. Embrace the future and become part of something greater with xAIM.
          </p>
          <div class="section-separator"></div>
          <h2 class="section-title scroll-reveal">xAIM Token Benefits</h2>
          <p class="section-description scroll-reveal">
            xAIM is the native utility token powering our innovative AI-driven platform. By holding xAIM, you're not just investing in a token – you're becoming part of an evolving digital ecosystem. Showcase your support for AI technology while gaining exclusive opportunities: compete in our unique tournament for a chance to win 5% of the total token supply, and prepare your champion for our upcoming interactive battle royale games. Join us in shaping the future of AI-powered digital entertainment.
          </p>
          <div class="section-separator"></div>
          <h2 class="section-title scroll-reveal">How It Works</h2>
          <div class="how-it-works-container scroll-reveal">
            <button id="revealProcessBtn" class="reveal-process-btn">
              <span class="btn-text">Reveal The Process</span>
              <div class="btn-particles"></div>
            </button>
          </div>

          <!-- How It Works Modal -->
          <div id="howItWorksModal" class="modal">
            <div class="modal-content">
              <button class="modal-close">&times;</button>
              <h2 class="modal-title">The Journey Begins</h2>
              <div class="steps-grid">
                <div class="step" data-step="1">
                  <div class="step-header">
                    <div class="step-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <h3>Create Your Champion</h3>
                  </div>
                  <div class="step-content">
                    <ul>
                      <li>Write your own creative prompt</li>
                      <li>Or supercharge it with our o3 mini-high AI enhancer</li>
                      <li>Watch your vision come to life in stunning 3D</li>
                    </ul>
                  </div>
                </div>

                <div class="step" data-step="2">
                  <div class="step-header">
                    <div class="step-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <h3>Secure Your Creation</h3>
                  </div>
                  <div class="step-content">
                    <ul>
                      <li>Save your model to our exclusive gallery</li>
                      <li>Receive your unique secret key</li>
                      <li>⚠️ Keep this key safe - it's your proof of ownership!</li>
                    </ul>
                  </div>
                </div>

                <div class="step" data-step="3">
                  <div class="step-header">
                    <div class="step-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.5 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V7.5L14.5 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 15L12 12L16 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <h3>Enter The Arena</h3>
                  </div>
                  <div class="step-content">
                    <ul>
                      <li>Join the epic Tournament of Champions</li>
                      <li>Battle against other creators' models</li>
                      <li>Face off with celebrity mascots</li>
                    </ul>
                  </div>
                </div>

                <div class="step" data-step="4">
                  <div class="step-header">
                    <div class="step-icon">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.21 13.89L7 23L12 20L17 23L15.79 13.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15C15.866 15 19 11.866 19 8C19 4.13401 15.866 1 12 1C8.13401 1 5 4.13401 5 8C5 11.866 8.13401 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <h3>Claim Victory</h3>
                  </div>
                  <div class="step-content">
                    <ul>
                      <li>Dominate the tournament brackets</li>
                      <li>Become the ultimate champion</li>
                      <li>🏆 Win 5% of the total xAIM supply!</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="section-separator"></div>
          <h2 class="section-title scroll-reveal">Open Source Commitment</h2>
          <p class="section-description scroll-reveal">
            We believe in transparency and community-driven development. Our entire codebase is open source and available for public review. This commitment to openness ensures fairness in our tournament system and builds trust with our community. Visit our GitHub repository to explore the code behind xAIM's innovative AI-powered platform.
          </p>
          <div class="section-separator"></div>
          <h2 class="section-title scroll-reveal">TriMind Tribunal</h2>
          <p class="section-description scroll-reveal">
            The TriMind Tribunal is an advanced AI-powered jury composed of ChatGPT, DeepSeek, and QWEN. These AI judges communicate and collaborate to evaluate and determine the best user-created 3D models. Experience a fair and intelligent selection process driven by cutting-edge AI decision-making.
          </p>
          <div class="section-separator"></div>
          <h2 class="section-title scroll-reveal">Featured mascot models</h2>
          <div class="grid-container scroll-reveal">
            <div class="grid-item model-viewer-container">
              <model-viewer
                src="combat.glb"
                camera-controls
                auto-rotate
                rotation-per-second="30deg"
                interaction-prompt="none"
                camera-orbit="0deg 75deg 105%"
                min-camera-orbit="auto 0deg auto"
                max-camera-orbit="auto 180deg auto"
                style="width: 100%; height: 100%; background: transparent;">
              </model-viewer>
            </div>
            <div class="grid-item model-viewer-container">
              <!-- Placeholder for second model -->
              <model-viewer
                src="war.glb"
                camera-controls
                auto-rotate
                rotation-per-second="30deg"
                interaction-prompt="none"
                camera-orbit="0deg 75deg 105%"
                min-camera-orbit="auto 0deg auto"
                max-camera-orbit="auto 180deg auto"
                style="width: 100%; height: 100%; background: transparent;">
              </model-viewer>
            </div>
            <div class="grid-item model-viewer-container">
              <!-- Placeholder for third model -->
              <model-viewer
                src="iron_man_hulk.glb"
                camera-controls
                auto-rotate
                rotation-per-second="30deg"
                interaction-prompt="none"
                camera-orbit="0deg 75deg 105%"
                min-camera-orbit="auto 0deg auto"
                max-camera-orbit="auto 180deg auto"
                style="width: 100%; height: 100%; background: transparent;">
              </model-viewer>
            </div>
          </div>
          <div class="section-separator"></div>
          <h2 class="section-title scroll-reveal">Design your own mascot</h2>
          <div class="prompt-holder">
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>
            <div class="scan-line"></div>
            <input type="text" placeholder="Enter your prompt here..." id="promptInput" />
            <button type="button" id="submitPrompt" class="button">Submit</button>
            <button type="button" id="enhancePrompt" class="button">Enhance with NEW o3-mini AI</button>
          </div>
          <!-- Red message to appear if user cannot generate -->
          <p id="generationLimitMessage" class="error-message" style="display: none;">
            You have reached the maximum amount of saved models.
          </p>
          <!-- Model Viewer Section -->
          <div id="generatedModelContainer" class="generated-model-container">
            <div class="grid-overlay"></div>
            <div class="binary-rain"></div>
            
            <div class="neon-edge neon-edge-h neon-top"></div>
            <div class="neon-edge neon-edge-h neon-bottom"></div>
            <div class="neon-edge neon-edge-v neon-left"></div>
            <div class="neon-edge neon-edge-v neon-right"></div>
            
            <div class="holo-ring"></div>
            <div class="holo-ring"></div>
            <div class="holo-ring"></div>
            
            <div class="energy-field"></div>
            <div class="wireframe-overlay"></div>
            
            <!-- Loading Animation -->
            <div class="loading-animation-container">
                <div class="processing-grid"></div>
                <div class="processing-lines">
                    <div class="processing-line"></div>
                    <div class="processing-line"></div>
                    <div class="processing-line"></div>
                    <div class="processing-line"></div>
                    <div class="processing-line"></div>
                </div>
                
                <div class="binary-shapes"></div>
                
                <div class="processing-status">
                    Generate your 3D Character
                    <div class="processing-steps"></div>
                </div>
                
                <!-- Replace wireframe and coins with xAIM_BOT model -->
                <div class="loading-model-container">
                    <model-viewer
                        id="loadingModelViewer"
                        src="xAIM_BOT.glb"
                        camera-controls="false"
                        auto-rotate
                        rotation-per-second="30deg"
                        interaction-prompt="none"
                        camera-orbit="0deg 75deg 105%"
                        min-camera-orbit="auto 0deg auto"
                        max-camera-orbit="auto 180deg auto"
                        style="width: 300px; height: 300px; background: transparent;"
                        class="loading-model">
                    </model-viewer>
                </div>
                
                <div class="particles-container">
                    <!-- Particles will be added dynamically via JavaScript -->
                </div>
                
                <div class="countdown-container">
                    <div class="countdown-timer">Estimated time: 4:59</div>
                </div>
            </div>
            
            <model-viewer
              id="generatedModelViewer"
              src=""
              camera-controls
              auto-rotate
              rotation-per-second="30deg"
              interaction-prompt="none"
              camera-orbit="0deg 75deg 105%"
              min-camera-orbit="auto 0deg auto"
              max-camera-orbit="auto 180deg auto"
              style="background: transparent;">
            </model-viewer>
          </div>
          <!-- New centered button group -->
          <div class="model-btn-group-centered">
            <button id="saveModel" class="button button-disabled" disabled>
              Save Model
            </button>
            <button id="downloadModel" class="button button-disabled" disabled>
              Download Model
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-wrapper">
        <div class="footer-tagline">
          <span class="glowing-text"><span class="x-prefix">x</span>Where AI Meets Blockchain</span>
        </div>
        <div class="social-links">
          <a href="https://x.com/xAIM3D" target="_blank" class="social-link">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16.99 3H20.25L14.1 10.07L21.33 19.5H15.77L11.24 13.64L6.06 19.5H2.8L9.39 11.93L2.5 3H8.19L12.3 8.37L16.99 3ZM16.4 17.77H17.93L7.52 4.66H5.87L16.4 17.77Z" fill="black"/>
            </svg>
          </a>
          <a href="https://t.me/xAIM3D" target="_blank" class="social-link">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.64 8.8C16.49 10.38 15.84 14.22 15.51 16.01C15.37 16.75 15.09 16.99 14.83 17.02C14.25 17.07 13.81 16.64 13.25 16.27C12.37 15.69 11.87 15.33 11.02 14.77C10.03 14.12 10.67 13.76 11.24 13.18C11.39 13.03 13.95 10.7 14 10.49C14.0069 10.4582 14.006 10.4252 13.9973 10.3938C13.9886 10.3624 13.9724 10.3337 13.95 10.31C13.89 10.26 13.81 10.28 13.74 10.29C13.65 10.31 12.25 11.24 9.52 13.08C9.12 13.35 8.76 13.49 8.44 13.48C8.08 13.47 7.4 13.28 6.89 13.11C6.26 12.91 5.77 12.8 5.81 12.45C5.83 12.27 6.08 12.09 6.55 11.9C9.47 10.63 11.41 9.79 12.38 9.39C15.16 8.23 15.73 8.03 16.11 8.03C16.19 8.03 16.38 8.05 16.5 8.15C16.6 8.23 16.63 8.34 16.64 8.42C16.63 8.48 16.65 8.66 16.64 8.8Z" fill="black"/>
            </svg>
          </a>
          <a href="https://github.com/ACEHiGH1/XAIM" target="_blank" class="social-link">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill="black" d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.11.82-.26.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.73.083-.73 1.205.085 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.605-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"/>
            </svg>
          </a>
        </div>
        <div class="legal-buttons">
          <a href="policy.html" class="legal-btn">Privacy Policy</a>
          <a href="terms.html" class="legal-btn">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>
  
  <!-- Include model-viewer script -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  
  <!-- Client-side Script -->
  <script>
    let userIp = null;

    // On page load, fetch the IP and also check if user can generate
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // 1) Get the user IP (optional if you're reusing it):
        const ipRes = await fetch('/api/log-ip');
        const ipData = await ipRes.json();
        console.log('Response from /api/log-ip:', ipData);
        userIp = ipData.ip; // store if needed

        // 2) Check if user can generate
        const response = await fetch('/api/can-generate');
        if (response.ok) {
          const data = await response.json();
          if (!data.canGenerate) {
            // If user cannot generate, disable the prompt & show the red message
            const promptInput = document.getElementById('promptInput');
            const submitPrompt = document.getElementById('submitPrompt');
            const enhancePromptBtn = document.getElementById('enhancePrompt');
            promptInput.disabled = true;
            submitPrompt.disabled = true;
            enhancePromptBtn.disabled = true;

            // Display the message in red below the prompt
            const generationLimitMessage = document.getElementById('generationLimitMessage');
            generationLimitMessage.style.display = 'block';
          }
        }
      } catch (err) {
        console.error('Error checking IP or generation limit:', err);
      }
    });

    document.addEventListener('DOMContentLoaded', async function() {
      const promptInput = document.getElementById('promptInput');
      const submitPrompt = document.getElementById('submitPrompt');
      const enhancePromptBtn = document.getElementById('enhancePrompt');
      const modelViewer = document.getElementById('generatedModelViewer');
      const saveModelBtn = document.getElementById('saveModel');
      const downloadModelBtn = document.getElementById('downloadModel');
      
      // How It Works Modal Functionality
      const modal = document.getElementById('howItWorksModal');
      const revealBtn = document.getElementById('revealProcessBtn');
      const closeBtn = modal.querySelector('.modal-close');
      
      function openModal() {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Add particles to button
        const particles = revealBtn.querySelector('.btn-particles');
        particles.innerHTML = '';
        for (let i = 0; i < 10; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = `${Math.random() * 100}%`;
          particle.style.top = `${Math.random() * 100}%`;
          particle.style.animationDelay = `${Math.random() * 1}s`;
          particles.appendChild(particle);
        }
      }
      
      function closeModal() {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
      
      revealBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);
      
      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeModal();
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          closeModal();
        }
      });

      // Add hover effect for steps
      const steps = document.querySelectorAll('.step');
      steps.forEach(step => {
        step.addEventListener('mouseenter', () => {
          const icon = step.querySelector('.step-icon');
          icon.style.transform = 'scale(1.1) rotate(5deg)';
        });
        
        step.addEventListener('mouseleave', () => {
          const icon = step.querySelector('.step-icon');
          icon.style.transform = '';
        });
      });
      
      // Initially disable submit, enhance, save, and download buttons
      submitPrompt.disabled = true;
      submitPrompt.classList.add('button-disabled');
      enhancePromptBtn.disabled = true;
      enhancePromptBtn.classList.add('button-disabled');
      saveModelBtn.disabled = true;
      saveModelBtn.classList.add('button-disabled');
      downloadModelBtn.disabled = true;
      downloadModelBtn.classList.add('button-disabled');
      
      // Track if current model has been saved
      let currentModelSaved = false;
      
      // Global variable to store the latest generated model data.
      let generatedModelData = null;
      
      // Add input event listener to enable/disable buttons
      promptInput.addEventListener('input', function() {
        const isEmpty = !this.value.trim();
        
        // Handle submit button
        if (!submitPrompt.dataset.loading) {
          submitPrompt.disabled = isEmpty;
          if (isEmpty) {
            submitPrompt.classList.add('button-disabled');
          } else {
            submitPrompt.classList.remove('button-disabled');
          }
        }
        
        // Handle enhance button
        if (!enhancePromptBtn.dataset.loading) {
          enhancePromptBtn.disabled = isEmpty;
          if (isEmpty) {
            enhancePromptBtn.classList.add('button-disabled');
          } else {
            enhancePromptBtn.classList.remove('button-disabled');
          }
        }
      });

      // Loading Animation Functions
      function initLoadingAnimation() {
          const particlesContainer = document.querySelector('.particles-container');
          const loadingContainer = document.querySelector('.loading-animation-container');
          const processingSteps = document.querySelector('.processing-steps');
          const countdownTimer = document.querySelector('.countdown-timer');
          const binaryShapes = document.querySelector('.binary-shapes');
          
          // Generate particles
          for (let i = 0; i < 30; i++) {
              const particle = document.createElement('div');
              particle.className = 'particle';
              particlesContainer.appendChild(particle);
          }
          
          // Initialize countdown
          const totalTime = 300; // 5 minutes in seconds
          let timeLeft = totalTime;
          
          const countdownInterval = setInterval(() => {
              timeLeft--;
              const minutes = Math.floor(timeLeft / 60);
              const seconds = timeLeft % 60;
              countdownTimer.textContent = `Estimated time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
              
              if (timeLeft <= 0) {
                  clearInterval(countdownInterval);
              }
          }, 1000);
          
          // Processing steps animation
          const steps = [
              'Initializing AI Processing...',
              'Analyzing Prompt Parameters...',
              'Generating Base Geometry...',
              'Applying Textures and Materials...',
              'Optimizing Mesh Structure...',
              'Finalizing 3D Model...'
          ];
          
          let currentStep = 0;
          const stepInterval = setInterval(() => {
              if (currentStep < steps.length) {
                  processingSteps.textContent = steps[currentStep];
                  currentStep++;
                  
                  // Update loading container class for different animation states
                  if (currentStep === 1) {
                      loadingContainer.classList.add('initializing');
                  } else if (currentStep === 3) {
                      loadingContainer.classList.remove('initializing');
                      loadingContainer.classList.add('processing');
                  } else if (currentStep === 5) {
                      loadingContainer.classList.remove('processing');
                      loadingContainer.classList.add('finalizing');
                  }
              } else {
                  clearInterval(stepInterval);
              }
          }, 50000 / steps.length); // Distribute steps over ~50 seconds
          
          // Generate binary numbers
          function createBinaryNumber() {
              const binary = document.createElement('div');
              binary.className = 'binary-number';
              binary.textContent = Math.random().toString(2).substr(2, 8);
              
              // Random position around the cube
              binary.style.left = `${Math.random() * 100}%`;
              binary.style.top = `${Math.random() * 100}%`;
              binary.style.animationDelay = `${Math.random() * 4}s`;
              
              binaryShapes.appendChild(binary);
              
              // Remove the binary number after animation
              setTimeout(() => {
                  binary.remove();
              }, 4000);
          }
          
          // Continuously create new binary numbers
          const binaryInterval = setInterval(() => {
              if (binaryShapes.children.length < 20) { // Limit to 20 numbers at a time
                  createBinaryNumber();
              }
          }, 200);
          
          return {
              clear: () => {
                  clearInterval(countdownInterval);
                  clearInterval(stepInterval);
                  clearInterval(binaryInterval);
                  loadingContainer.style.display = 'none';
              }
          };
      }

      const submitHandler = async () => {
          const prompt = promptInput.value.trim();
          if (!prompt) return;
      
          try {
              // Show loading animation
              const loadingAnimation = initLoadingAnimation();
              document.querySelector('.loading-animation-container').style.display = 'flex';
              
              // Update processing status text
              const processingStatus = document.querySelector('.processing-status');
              processingStatus.innerHTML = 'Generating 3D Model<div class="processing-steps">Initializing AI Processing...</div>';
              
              // Disable buttons and show loading state
              submitPrompt.disabled = true;
              submitPrompt.classList.add('button-disabled');
              submitPrompt.dataset.loading = 'true';
              submitPrompt.textContent = 'Generating...';
              
              enhancePromptBtn.disabled = true;
              enhancePromptBtn.classList.add('button-disabled');
              
              // Disable save and download buttons and clear current model
              saveModelBtn.disabled = true;
              saveModelBtn.classList.add('button-disabled');
              downloadModelBtn.disabled = true;
              downloadModelBtn.classList.add('button-disabled');
              modelViewer.setAttribute('src', '');
              
              const response = await fetch('/api/generate', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ prompt })
              });

              if (response.ok) {
                  const result = await response.json();
                  console.log('Response from server:', result);
                  if (result.model_3d_url) {
                      generatedModelData = {
                          prompt: prompt,
                          thumbnail_url: result.thumbnail_url,
                          model_3d_url: result.model_3d_url,
                          video_url: result.video_url,
                          texture_urls: result.texture_urls
                      };
                      
                      // Clear loading animation
                      loadingAnimation.clear();
                      
                      modelViewer.setAttribute('src', '/api/proxy?url=' + encodeURIComponent(result.model_3d_url));
                      
                      // Reset the saved state for new model
                      currentModelSaved = false;
                      // Enable save and download buttons when model is loaded
                      saveModelBtn.disabled = false;
                      saveModelBtn.classList.remove('button-disabled');
                      downloadModelBtn.disabled = false;
                      downloadModelBtn.classList.remove('button-disabled');
                  } else {
                      modelViewer.innerHTML = '<p>Error: 3D model URL not found.</p>';
                      saveModelBtn.disabled = true;
                      saveModelBtn.classList.add('button-disabled');
                  }
              } else {
                  console.error('Server error when generating prompt');
                  modelViewer.innerHTML = '<p>Error generating 3D model.</p>';
                  saveModelBtn.disabled = true;
                  saveModelBtn.classList.add('button-disabled');
              }
          } catch (err) {
              console.error('Network error:', err);
              modelViewer.innerHTML = '<p>Error generating 3D model.</p>';
              saveModelBtn.disabled = true;
              saveModelBtn.classList.add('button-disabled');
          } finally {
              // Re-enable other buttons
              submitPrompt.disabled = !promptInput.value.trim();
              if (!submitPrompt.disabled) {
                  submitPrompt.classList.remove('button-disabled');
              }
              delete submitPrompt.dataset.loading;
              submitPrompt.textContent = 'Submit';
              
              enhancePromptBtn.disabled = !promptInput.value.trim();
              if (!enhancePromptBtn.disabled) {
                  enhancePromptBtn.classList.remove('button-disabled');
              }
          }
      };
    
      promptInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && !submitPrompt.disabled) {
          event.preventDefault();
          submitHandler();
        }
      });
    
      submitPrompt.addEventListener('click', submitHandler);

      // Download button functionality
      downloadModelBtn.addEventListener('click', function() {
        if (!generatedModelData || !generatedModelData.model_3d_url) return;
        const a = document.createElement('a');
        // Use the same proxy endpoint as the model viewer for proper CORS handling
        a.href = '/api/proxy?url=' + encodeURIComponent(generatedModelData.model_3d_url);
        a.download = 'model.glb';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });

      // Add this right after your generatedModelContainer div in the HTML
      const saveMessageContainer = document.createElement('div');
      saveMessageContainer.className = 'save-message';
      saveMessageContainer.style.display = 'none';
      document.getElementById('generatedModelContainer').appendChild(saveMessageContainer);

      // Add secret key message container
      const secretKeyContainer = document.createElement('div');
      secretKeyContainer.className = 'secret-key-container';
      secretKeyContainer.style.display = 'none';
      secretKeyContainer.innerHTML = `
        <div class="secret-key-content">
          <button class="secret-key-exit">×</button>
          <h3>Your Secret Key</h3>
          <p class="secret-key-warning">Please save this key securely. It will only be shown once!</p>
          <div class="secret-key-value"></div>
          <button class="copy-key-btn">Copy Key</button>
        </div>
      `;
      document.getElementById('generatedModelContainer').appendChild(secretKeyContainer);

      // Add exit button handler
      const secretKeyExit = secretKeyContainer.querySelector('.secret-key-exit');
      secretKeyExit.addEventListener('click', () => {
        secretKeyContainer.style.display = 'none';
      });

      // Add save dialog
      const saveDialog = document.createElement('div');
      saveDialog.className = 'preview-dialog';
      saveDialog.style.display = 'none';
      saveDialog.innerHTML = `
        <div class="preview-content">
          <h3>Name Your Robot</h3>
          <div class="name-input-container">
            <input type="text" id="robotNameInput" placeholder="Enter robot name" class="robot-name-input">
            <div class="name-error" style="display: none; color: #ff0000; font-size: 12px; margin-top: 5px;">
              Please enter a name for your robot
            </div>
          </div>
          <div class="preview-actions">
            <button class="confirm-btn" id="confirmSave">Save</button>
            <button class="cancel-btn" id="cancelSave">Cancel</button>
          </div>
        </div>
      `;
      document.body.appendChild(saveDialog);

      // Updated save button handler
      saveModelBtn.addEventListener('click', function() {
        if (!generatedModelData) {
          saveMessageContainer.textContent = 'Generate a 3D model first before saving.';
          saveMessageContainer.className = 'save-message error';
          saveMessageContainer.style.display = 'block';
          setTimeout(() => {
            saveMessageContainer.style.display = 'none';
          }, 5000);
          return;
        }

        if (currentModelSaved) {
          saveMessageContainer.textContent = 'This model has already been saved.';
          saveMessageContainer.className = 'save-message error';
          saveMessageContainer.style.display = 'block';
          setTimeout(() => {
            saveMessageContainer.style.display = 'none';
          }, 5000);
          return;
        }

        // Show the name input dialog
        saveDialog.style.display = 'flex';
        document.getElementById('robotNameInput').value = '';
        document.getElementById('robotNameInput').focus();
      });

      // Handle save confirmation
      document.getElementById('confirmSave').addEventListener('click', async function() {
        const robotName = document.getElementById('robotNameInput').value.trim();
        const nameError = document.querySelector('.name-error');
        
        if (!robotName) {
          nameError.style.display = 'block';
          return;
        }
        nameError.style.display = 'none';

        try {
          // Disable buttons and show loading state
          this.disabled = true;
          this.textContent = 'Saving...';
          saveModelBtn.disabled = true;
          saveModelBtn.classList.add('button-disabled');
          saveModelBtn.dataset.loading = 'true';
          
          // 3) Add `ip_address: userIp` to your POST body:
          const saveResponse = await fetch('/api/models', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              ...generatedModelData,
              name: robotName,
              ip_address: userIp        // <-- pass the IP from the front-end
            })
          });

          if (saveResponse.ok) {
            const savedData = await saveResponse.json();
            
            // Show secret key to user
            const secretKeyValue = document.querySelector('.secret-key-value');
            secretKeyValue.textContent = savedData.secret_key;
            secretKeyContainer.style.display = 'block';
            
            // Add copy button functionality
            const copyKeyBtn = document.querySelector('.copy-key-btn');
            copyKeyBtn.addEventListener('click', async () => {
              try {
                await navigator.clipboard.writeText(savedData.secret_key);
                copyKeyBtn.textContent = 'Copied!';
                copyKeyBtn.classList.add('button-success');
                setTimeout(() => {
                  copyKeyBtn.textContent = 'Copy Key';
                  copyKeyBtn.classList.remove('button-success');
                }, 2000);
              } catch (err) {
                console.error('Failed to copy:', err);
                copyKeyBtn.textContent = 'Failed to copy';
                copyKeyBtn.classList.add('button-error');
                setTimeout(() => {
                  copyKeyBtn.textContent = 'Copy Key';
                  copyKeyBtn.classList.remove('button-error');
                }, 2000);
              }
            });
            
            saveMessageContainer.textContent = 'Model saved successfully! View it with its attributes in the gallery.';
            saveMessageContainer.className = 'save-message success';
            console.log('Saved model data:', savedData);
            currentModelSaved = true;
            saveDialog.style.display = 'none';

            // Reset the model viewer and hide it
            modelViewer.setAttribute('src', '');
            modelViewer.style.display = 'none';
            
            // Reset and show the loading animation container
            const loadingContainer = document.querySelector('.loading-animation-container');
            loadingContainer.style.display = 'flex';
            loadingContainer.classList.remove('initializing', 'processing', 'finalizing');
            
            // Reset the processing status text
            const processingStatus = document.querySelector('.processing-status');
            processingStatus.innerHTML = 'Generate your 3D Character<div class="processing-steps"></div>';
            
            // Reset countdown timer
            const countdownTimer = document.querySelector('.countdown-timer');
            countdownTimer.textContent = 'Estimated time: 4:59';
            
            // Clear the prompt input
            promptInput.value = '';
            
            // Disable the buttons
            submitPrompt.disabled = true;
            submitPrompt.classList.add('button-disabled');
            enhancePromptBtn.disabled = true;
            enhancePromptBtn.classList.add('button-disabled');
            
            // Reset generated model data and disable download button
            generatedModelData = null;
            downloadModelBtn.disabled = true;
            downloadModelBtn.classList.add('button-disabled');

            // Reinitialize the binary numbers and particles
            const particlesContainer = document.querySelector('.particles-container');
            particlesContainer.innerHTML = '';
            const binaryShapes = document.querySelector('.binary-shapes');
            binaryShapes.innerHTML = '';
            
            // Generate new particles
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particlesContainer.appendChild(particle);
            }

            // Re-check after saving
            const canGenerateRes = await fetch('/api/can-generate');
            if (canGenerateRes.ok) {
              const canGenerateData = await canGenerateRes.json();
              if (!canGenerateData.canGenerate) {
                // If user is now at the limit, disable prompt immediately
                disablePromptAndShowLimitMessage();
              }
            }
          } else {
            throw new Error('Save failed');
          }
        } catch (err) {
          console.error('Error saving model:', err);
          saveMessageContainer.textContent = 'Error saving the model.';
          saveMessageContainer.className = 'save-message error';
        } finally {
          // Show the message
          saveMessageContainer.style.display = 'block';
          
          // Hide the message after 5 seconds
          setTimeout(() => {
            saveMessageContainer.style.display = 'none';
          }, 5000);
          
          // Reset the save button state
          saveModelBtn.disabled = true;
          saveModelBtn.classList.add('button-disabled');
          delete saveModelBtn.dataset.loading;
          saveModelBtn.textContent = 'Save Model';
          
          // Re-enable the confirm save button
          this.disabled = false;
          this.textContent = 'Save';
        }
      });

      // Handle save cancellation
      document.getElementById('cancelSave').addEventListener('click', function() {
        saveDialog.style.display = 'none';
        document.querySelector('.name-error').style.display = 'none';
      });

      // Close dialog when clicking outside
      saveDialog.addEventListener('click', function(e) {
        if (e.target === saveDialog) {
          saveDialog.style.display = 'none';
          document.querySelector('.name-error').style.display = 'none';
        }
      });

      enhancePromptBtn.addEventListener('click', async function() {
        const currentPrompt = promptInput.value.trim();
        if (!currentPrompt) return;
        
        try {
          // Disable both buttons and show loading state
          enhancePromptBtn.disabled = true;
          enhancePromptBtn.classList.add('button-disabled');
          enhancePromptBtn.dataset.loading = 'true';
          enhancePromptBtn.textContent = 'Enhancing...';
          
          // Disable submit button and clear prompt input
          submitPrompt.disabled = true;
          submitPrompt.classList.add('button-disabled');
          
          // Store the current prompt value and show loading in placeholder
          const originalPlaceholder = promptInput.placeholder;
          promptInput.value = '';
          promptInput.placeholder = 'Loading enhanced prompt...';
          promptInput.disabled = true; // Prevent user input while loading
          
          const response = await fetch('/api/enhance', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: currentPrompt })
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.enhanced_prompt) {
              promptInput.value = data.enhanced_prompt;
              // Re-enable submit button since we have a valid prompt
              submitPrompt.disabled = false;
              submitPrompt.classList.remove('button-disabled');
            } else {
              promptInput.value = currentPrompt; // Restore original prompt on error
              saveMessageContainer.textContent = 'Enhanced prompt not returned.';
              saveMessageContainer.className = 'save-message error';
              saveMessageContainer.style.display = 'block';
              setTimeout(() => {
                saveMessageContainer.style.display = 'none';
              }, 5000);
            }
          } else {
            promptInput.value = currentPrompt; // Restore original prompt on error
            saveMessageContainer.textContent = 'Error enhancing prompt.';
            saveMessageContainer.className = 'save-message error';
            saveMessageContainer.style.display = 'block';
            setTimeout(() => {
              saveMessageContainer.style.display = 'none';
            }, 5000);
          }
        } catch (error) {
          console.error('Error during prompt enhancement:', error);
          promptInput.value = currentPrompt; // Restore original prompt on error
          saveMessageContainer.textContent = 'Network error while enhancing prompt.';
          saveMessageContainer.className = 'save-message error';
          saveMessageContainer.style.display = 'block';
          setTimeout(() => {
            saveMessageContainer.style.display = 'none';
          }, 5000);
        } finally {
          // Re-enable input and restore placeholder
          promptInput.disabled = false;
          promptInput.placeholder = 'Enter your prompt here...';
          
          // Re-enable enhance button
          enhancePromptBtn.disabled = !promptInput.value.trim();
          if (!enhancePromptBtn.disabled) {
            enhancePromptBtn.classList.remove('button-disabled');
          }
          delete enhancePromptBtn.dataset.loading;
          enhancePromptBtn.textContent = 'Enhance with NEW o3-mini AI';
          
          // Re-enable submit button only if there's text in the input
          submitPrompt.disabled = !promptInput.value.trim();
          if (!submitPrompt.disabled) {
            submitPrompt.classList.remove('button-disabled');
          }
        }
      });

      // Add model-viewer load event listener
      modelViewer.addEventListener('load', () => {
        if (modelViewer.getAttribute('src') && !currentModelSaved) {
          saveModelBtn.disabled = false;
          saveModelBtn.classList.remove('button-disabled');
          downloadModelBtn.disabled = false;
          downloadModelBtn.classList.remove('button-disabled');
        }
      });

      // Add model-viewer error event listener
      modelViewer.addEventListener('error', () => {
        saveModelBtn.disabled = true;
        saveModelBtn.classList.add('button-disabled');
        downloadModelBtn.disabled = true;
        downloadModelBtn.classList.add('button-disabled');
      });

      // Copy Token Address functionality
      document.getElementById('copyTokenBtn').addEventListener('click', async function() {
        const textToCopy = "Coming Soon";
        
        try {
          await navigator.clipboard.writeText(textToCopy);
          
          // Add a temporary success class for visual feedback
          this.classList.add('button-success');
          this.textContent = 'Copied!';
          
          // Reset button after 2 seconds
          setTimeout(() => {
            this.classList.remove('button-success');
            this.textContent = 'Copy Token Address';
          }, 2000);
          
        } catch (err) {
          console.error('Failed to copy:', err);
          this.classList.add('button-error');
          
          // Reset button after 2 seconds
          setTimeout(() => {
            this.classList.remove('button-error');
            this.textContent = 'Copy Token Address';
          }, 2000);
        }
      });
    });

    function createBinaryRain() {
        const rainContainer = document.querySelector('.binary-rain');
        const containerWidth = rainContainer.offsetWidth;
        const columnWidth = 20; // Width of each column in pixels
        const columns = Math.ceil(containerWidth / columnWidth); // Calculate number of columns needed
        
        // Clear existing columns
        rainContainer.innerHTML = '';
        
        for(let i = 0; i < columns; i++) {
            const column = document.createElement('div');
            column.className = 'binary-column';
            column.style.left = `${columnWidth * i}px`;
            column.style.animationDuration = `${Math.random() * 10 + 5}s`; // Random speed
            column.style.animationDelay = `${Math.random() * 5}s`; // Random start time
            
            // Create longer binary string for full coverage
            let binaryString = '';
            for(let j = 0; j < 50; j++) { // Increased number of characters
                binaryString += Math.random() > 0.5 ? '1' : '0';
                binaryString += '\n';
            }
            column.textContent = binaryString;
            
            rainContainer.appendChild(column);
        }
    }

    // Initialize binary rain effect
    document.addEventListener('DOMContentLoaded', createBinaryRain);
    
    // Recreate binary rain on window resize for proper coverage
    window.addEventListener('resize', createBinaryRain);

    // Add scroll reveal functionality
    function handleScrollReveal() {
      const elements = document.querySelectorAll('.scroll-reveal');
      const windowHeight = window.innerHeight;

      elements.forEach(element => {
        const elementTop = element.getBoundingClientRect().top;
        if (elementTop < windowHeight * 0.85) { // Reveal when element is 85% in view
          element.classList.add('revealed');
        }
      });
    }

    // Initial check for elements in view
    handleScrollReveal();

    // Add scroll event listener
    window.addEventListener('scroll', handleScrollReveal);

    function disablePromptAndShowLimitMessage() {
      const promptInput = document.getElementById('promptInput');
      const submitPrompt = document.getElementById('submitPrompt');
      const enhancePromptBtn = document.getElementById('enhancePrompt');

      promptInput.disabled = true;
      submitPrompt.disabled = true;
      enhancePromptBtn.disabled = true;

      const generationLimitMessage = document.getElementById('generationLimitMessage');
      generationLimitMessage.style.display = 'block'; // Make the red message appear
    }
  </script>
</body>
</html>
